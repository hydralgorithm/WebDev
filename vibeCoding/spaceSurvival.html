<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space Survival — Neon Dodger</title>
  <link rel="icon" type="image/png" href="/html_css/Favicon/apple-touch-icon.png">
  <style>
    :root{
      --bg1: #02040a; --bg2:#000005; --accent-cyan:#00f0ff; --accent-pink:#ff2dff; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{
      background: radial-gradient(1200px 700px at 20% 20%, rgba(0,240,255,0.03), transparent 8%),
                  radial-gradient(900px 500px at 85% 85%, rgba(255,45,255,0.02), transparent 6%),
                  linear-gradient(180deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:28px;color:#dff7ff;
    }

    .card{
      width:980px; max-width:96vw; height:640px; max-height:92vh; border-radius:18px; overflow:hidden; position:relative;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
      box-shadow: 0 14px 60px rgba(2,6,23,0.7); border:1px solid rgba(255,255,255,0.02); display:grid; grid-template-columns: 1fr 320px;
    }
    iframe
    /* game column */
    .game-area{position:relative;padding:18px;display:flex;align-items:center;justify-content:center}
    .viewport{position:relative;width:100%;height:100%;border-radius:12px;overflow:hidden;background:linear-gradient(180deg, rgba(2,6,15,0.9), rgba(0,0,0,0.95));border:1px solid rgba(255,255,255,0.02)}

    canvas{display:block;position:absolute;inset:0;width:100%;height:100%}

    .hud{position:absolute;left:20px;top:18px;z-index:12;display:flex;gap:12px}
    .badge{padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(6px);font-weight:700}

    /* right panel */
    .sidebar{padding:28px;display:flex;flex-direction:column;gap:18px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.02)}
    .title{font-weight:900;font-size:20px;color:transparent;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-pink));-webkit-background-clip:text;background-clip:text}
    .muted{opacity:0.75;font-size:13px}

    .controls{display:flex;gap:8px;margin-top:8px}
    .btn{appearance:none;border:0;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02);color:inherit;font-weight:800;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .btn.primary{background:linear-gradient(90deg,var(--accent-cyan),var(--accent-pink));color:#021219}

    .instructions{font-size:13px;color:#cfeeff;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}

    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:20;pointer-events:none}
    .overlay .card{pointer-events:auto}

    .menu{width:84%;max-width:420px;background:linear-gradient(180deg, rgba(2,6,23,0.7), rgba(4,8,18,0.75));border-radius:14px;padding:20px;text-align:center;border:1px solid rgba(255,255,255,0.03)}
    .menu h1{margin:0 0 8px 0;font-size:24px;font-weight:900;color:transparent;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-pink));-webkit-background-clip:text;background-clip:text}
    .menu p{margin:0 0 12px 0;color:#bfefff}
    .menu .row{display:flex;gap:10px;justify-content:center}

    @media (max-width:960px){
      .card{grid-template-columns:1fr 260px;height:86vh}
    }
    @media (max-width:720px){
      .card{grid-template-columns:1fr;height:92vh}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="game-area">
      <div class="viewport" id="viewport">
        <canvas id="bgCanvas"></canvas>
        <canvas id="gameCanvas"></canvas>

        <div class="hud">
          <div class="badge">Score: <span id="score">0</span></div>
          <div class="badge">Best: <span id="best">0</span></div>
        </div>

        <div class="overlay" id="overlay">
          <div class="menu" id="menu" style="pointer-events:auto">
            <h1>SPACE SURVIVAL</h1>
            <p>Pilot your spaceship — dodge meteors and survive as long as possible.</p>
            <div class="row">
              <button class="btn primary" id="startBtn">Press SPACE to Start</button>
              <button class="btn" id="howBtn">How to Play</button>
            </div>
            <div style="height:8px"></div>
            <div style="font-size:13px;color:#cfefff">Controls: ← / → or A / D. Touch left & right on mobile.</div>
          </div>
        </div>

      </div>
    </div>

    <aside class="sidebar">
      <div class="panel">
        <div class="title">Space Survival</div>
        <div class="muted">Smooth controls • Canvas-rendered sprites • No external images</div>
        <div class="controls">
          <button class="btn" id="pauseBtn">Pause</button>
          <button class="btn" id="resetBtn">Reset</button>
        </div>
      </div>

      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:800">Stats</div>
          <div class="muted" id="levelDisplay">Level 1</div>
        </div>
        <div class="instructions">
          Avoid falling meteors. Score points as meteors pass the bottom. Difficulty increases with time. Press SPACE to start or restart. Use touch controls on mobile by tapping left/right halves.
        </div>
      </div>

      <div class="panel">
        <div style="font-weight:800;margin-bottom:8px">Tips</div>
        <div class="muted">Small smooth movements are better than frantic tapping. Keep near the center to react to waves.</div>
      </div>

    </aside>
  </div>

  <script>
    // Canvas + HiDPI setup
    const viewport = document.getElementById('viewport');
    const bgCanvas = document.getElementById('bgCanvas');
    const gameCanvas = document.getElementById('gameCanvas');
    const bgCtx = bgCanvas.getContext('2d');
    const ctx = gameCanvas.getContext('2d');

    function resize(){
      const rect = viewport.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      bgCanvas.style.width = gameCanvas.style.width = rect.width + 'px';
      bgCanvas.style.height = gameCanvas.style.height = rect.height + 'px';
      bgCanvas.width = Math.floor(rect.width * dpr); bgCanvas.height = Math.floor(rect.height * dpr);
      gameCanvas.width = Math.floor(rect.width * dpr); gameCanvas.height = Math.floor(rect.height * dpr);
      bgCtx.setTransform(dpr,0,0,dpr,0,0); ctx.setTransform(dpr,0,0,dpr,0,0);
      W = rect.width; H = rect.height;
      makeStars();
      resetPlayer();
    }

    window.addEventListener('resize', resize);

    // starfield
    let stars = [];
    function makeStars(){
      stars = [];
      const count = Math.floor((W*H)/8000);
      for(let i=0;i<count;i++) stars.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.6+0.3,spd:0.2+Math.random()*0.9,alpha:0.3+Math.random()*0.7});
    }

    function drawBG(t){
      bgCtx.clearRect(0,0,W,H);
      // faint nebula
      const g = bgCtx.createLinearGradient(0,0,W,H);
      g.addColorStop(0,'rgba(12,8,28,0.6)'); g.addColorStop(1,'rgba(0,0,0,0.9)');
      bgCtx.fillStyle = g; bgCtx.fillRect(0,0,W,H);
      // stars
      for(const s of stars){
        s.y += s.spd * (1 + difficulty*0.06);
        if(s.y > H) s.y = -2;
        bgCtx.beginPath(); bgCtx.globalAlpha = s.alpha * (0.6 + 0.4*Math.sin(t/800 + s.x*0.02));
        bgCtx.fillStyle = '#fff'; bgCtx.arc(s.x,s.y,s.r,0,Math.PI*2); bgCtx.fill();
      }
      bgCtx.globalAlpha = 1;
      // small subtle gradient overlay
      bgCtx.fillStyle = 'rgba(10,6,20,0.04)'; bgCtx.fillRect(0,0,W,H);
    }

    // Game state
    let W = 900, H = 520;
    let running = false, paused = false, lastT = 0;
    let score = 0, best = parseInt(localStorage.getItem('spaceSurvBest')||'0');
    document.getElementById('best').textContent = best;
    let difficulty = 0; let level = 1;

    // Player (spaceship)
    const player = {x:W/2, y: H - 90, w:56, h:36, vx:0, ax:0, maxSpeed: 520, accel: 2200, friction: 8};
    function resetPlayer(){ player.w = Math.max(42, Math.floor(W*0.06)); player.h = Math.max(28, Math.floor(H*0.06)); player.x = W/2; player.y = H - player.h*2.6; player.vx = 0; }

    // Input
    const input = {left:false,right:false};
    window.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft' || e.key==='a' || e.key==='A') input.left=true; if(e.key==='ArrowRight' || e.key==='d' || e.key==='D') input.right=true; if(e.code==='Space'){ if(!running) startGame(); else if(!paused) { paused = true; document.getElementById('pauseBtn').textContent='Resume' } else { paused=false; document.getElementById('pauseBtn').textContent='Pause' } } });
    window.addEventListener('keyup', e=>{ if(e.key==='ArrowLeft' || e.key==='a' || e.key==='A') input.left=false; if(e.key==='ArrowRight' || e.key==='d' || e.key==='D') input.right=false; });

    // Touch controls (tap left/right half)
    let touchId = null;
    viewport.addEventListener('touchstart', e=>{
      const t = e.changedTouches[0]; touchId = t.identifier; const rect = viewport.getBoundingClientRect(); const x = t.clientX - rect.left; input.left = x < rect.width/2; input.right = x >= rect.width/2; e.preventDefault();
    },{passive:false});
    viewport.addEventListener('touchmove', e=>{ const t = Array.from(e.changedTouches).find(z=>z.identifier===touchId); if(!t) return; const rect = viewport.getBoundingClientRect(); const x = t.clientX - rect.left; input.left = x < rect.width/2; input.right = x >= rect.width/2; },{passive:true});
    viewport.addEventListener('touchend', e=>{ const t = Array.from(e.changedTouches).find(z=>z.identifier===touchId); if(t){ input.left=false; input.right=false; touchId=null } });

    // Meteors
    let meteors = [];
    function spawnMeteor(){ const r = 12 + Math.random()*28; const x = r + Math.random()*(W - r*2); const y = -r - 10; const vy = 90 + Math.random()*160 + difficulty*25; const vx = (Math.random()-0.5)*40; const rot = Math.random()*Math.PI*2; meteors.push({x,y,r,vy,vx,rot,rotSpeed:(Math.random()-0.5)*2}); }

    // Collision: circle vs rect
    function circleRectCollision(cx,cy,r, rx,ry,rw,rh){ const closestX = Math.max(rx, Math.min(cx, rx+rw)); const closestY = Math.max(ry, Math.min(cy, ry+rh)); const dx = cx - closestX; const dy = cy - closestY; return (dx*dx + dy*dy) <= r*r; }

    // Particles for meteor trails and explosions
    let parts = [];
    function spawnExplosion(x,y,color,count=18){ for(let i=0;i<count;i++){ parts.push({x,y,vx:(Math.random()-0.5)*220, vy:(Math.random()-1.5)*220, life:0.6+Math.random()*0.9, age:0, color}) } }

    // main update/draw
    let spawnTimer = 0; let spawnRate = 1.0; function update(dt){ if(!running || paused) return;
      // difficulty scaling
      if(timeElapsed > level*6){ level++; difficulty += 1; spawnRate = Math.max(0.38, spawnRate - 0.08); document.getElementById('levelDisplay').textContent = 'Level ' + level }

      // input -> acceleration
      const dir = (input.right?1:0) - (input.left?1:0);
      const targetAccel = dir * player.accel;
      player.vx += targetAccel * dt;
      // apply friction 
      player.vx -= player.vx * Math.min(1, player.friction* dt);
      // clamp speed
      if(player.vx > player.maxSpeed) player.vx = player.maxSpeed; if(player.vx < -player.maxSpeed) player.vx = -player.maxSpeed;
      player.x += player.vx * dt;
      // clamp inside
      const halfW = player.w/2; if(player.x < halfW) { player.x = halfW; player.vx = 0 } if(player.x > W - halfW) { player.x = W - halfW; player.vx = 0 }

      // spawn meteors
      spawnTimer -= dt; if(spawnTimer <= 0){ spawnTimer = spawnRate * (0.7 + Math.random()*0.9); spawnMeteor(); if(Math.random() < 0.12) spawnMeteor(); }

      // update meteors
      for(let i=meteors.length-1;i>=0;i--){ const m = meteors[i]; m.x += m.vx * dt; m.y += m.vy * dt; m.rot += m.rotSpeed * dt; // trail particles
        parts.push({x: m.x - m.vx*0.02, y: m.y - m.vy*0.02, vx: -m.vx*0.2 + (Math.random()-0.5)*30, vy: -m.vy*0.2 + Math.random()*20, life:0.6, age:0, color:'rgba(255,150,60,0.9)'});
        // offscreen
        if(m.y - m.r > H + 40){ meteors.splice(i,1); score += 1; document.getElementById('score').textContent = Math.floor(score); }
        else{
          // collision
          const rx = player.x - player.w/2; const ry = player.y - player.h/2; if(circleRectCollision(m.x,m.y,m.r, rx, ry, player.w, player.h)){ running=false; paused=false; // explosion
            spawnExplosion(player.x, player.y, 'rgba(255,100,100,1)', 26); spawnExplosion(m.x,m.y,'rgba(255,200,100,1)', 18); endGame(); return; }
        }
      }

      // update particles
      for(let i=parts.length-1;i>=0;i--){ const p = parts[i]; p.age += dt; if(p.age > p.life) parts.splice(i,1); else{ p.x += p.vx*dt; p.y += p.vy*dt; p.vy += 320*dt; }}

      // score increase by survival slightly
      score += dt * 0.6 * (1 + difficulty*0.06);
      document.getElementById('score').textContent = Math.floor(score);
    }

    function drawShip(cx,cy,w,h,vx){ ctx.save(); ctx.translate(cx,cy);
      // shadow glow
      ctx.beginPath(); ctx.ellipse(0,4,w*0.9,h*0.7,0,0,Math.PI*2); ctx.fillStyle = 'rgba(0,240,255,0.04)'; ctx.fill();
      // body
      ctx.beginPath(); ctx.moveTo(-w*0.5, h*0.5); ctx.quadraticCurveTo(0, -h*0.9, w*0.5, h*0.5); ctx.closePath();
      const g = ctx.createLinearGradient(-w*0.5,-h*0.9,w*0.5,h*0.5); g.addColorStop(0,'#00f0ff'); g.addColorStop(1,'#ff2dff'); ctx.fillStyle = g; ctx.fill();
      // cockpit
      ctx.beginPath(); ctx.ellipse(0, -h*0.06, w*0.18, h*0.2, 0, 0, Math.PI*2); ctx.fillStyle = 'rgba(3,8,18,0.7)'; ctx.fill();
      // thruster when moving
      const thrust = Math.min(1, Math.abs(vx)/300);
      if(thrust > 0.02){ ctx.beginPath(); ctx.moveTo(-w*0.18, h*0.55); ctx.lineTo(0, h*0.55 + 18*thrust); ctx.lineTo(w*0.18, h*0.55); ctx.closePath();
        const tg = ctx.createLinearGradient(0,h*0.55,0,h*0.55+18*thrust); tg.addColorStop(0,'rgba(255,240,150,0.95)'); tg.addColorStop(1,'rgba(255,80,10,0.05)'); ctx.fillStyle = tg; ctx.fill(); }
      // outline
      ctx.lineWidth = 1.5; ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.stroke(); ctx.restore(); }

    function drawMeteor(m){ // body
      ctx.save(); ctx.translate(m.x,m.y); ctx.rotate(m.rot);
      const rad = m.r;
      const g = ctx.createRadialGradient(-rad*0.25, -rad*0.25, rad*0.1, 0, 0, rad);
      g.addColorStop(0,'#ffd9a6'); g.addColorStop(0.45,'#ff9a3a'); g.addColorStop(1,'#8b3b1a');
      ctx.fillStyle = g; ctx.beginPath(); ctx.arc(0,0,rad,0,Math.PI*2); ctx.fill();
      // crater-ish darker spots
      ctx.beginPath(); ctx.fillStyle = 'rgba(0,0,0,0.08)'; ctx.arc(-rad*0.25, -rad*0.1, rad*0.2, 0, Math.PI*2); ctx.fill();
      ctx.restore();
      // tail
      ctx.save(); ctx.globalCompositeOperation = 'lighter'; ctx.beginPath(); ctx.moveTo(m.x - m.vx*0.6, m.y - m.vy*0.6);
      ctx.lineTo(m.x - m.vx*2.8, m.y - m.vy*2.8); ctx.lineWidth = Math.max(2, rad*0.6); ctx.strokeStyle = 'rgba(255,140,40,0.14)'; ctx.stroke(); ctx.restore(); }

    function draw(){ ctx.clearRect(0,0,W,H);
      // meteors
      for(const m of meteors) drawMeteor(m);
      // particles
      for(const p of parts){ const alpha = Math.max(0, 1 - p.age/p.life); ctx.beginPath(); ctx.globalAlpha = alpha; ctx.fillStyle = p.color || 'rgba(255,200,120,0.9)'; ctx.arc(p.x,p.y, Math.max(1,4*(1 - p.age/p.life)),0,Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; }
      // ship
      drawShip(player.x, player.y, player.w, player.h, player.vx);
      // vignette
      ctx.save(); ctx.globalCompositeOperation='multiply'; const vg = ctx.createLinearGradient(0,0,0,H); vg.addColorStop(0,'rgba(0,0,0,0)'); vg.addColorStop(1,'rgba(0,0,0,0.22)'); ctx.fillStyle = vg; ctx.fillRect(0,0,W,H); ctx.restore();
    }

    function loop(ts){ if(!lastT) lastT=ts; const dt = Math.min(40, ts-lastT)/1000; lastT = ts; drawBG(ts); update(dt); draw(); if(running) requestAnimationFrame(loop); }

    // Start / end / reset
    let timeElapsed = 0;
    function startGame(){ if(running) return; running = true; paused=false; meteors = []; parts = []; score = 0; difficulty = 0; level = 1; spawnRate = 1.0; spawnTimer = 0; timeElapsed = 0; document.getElementById('score').textContent = '0'; document.getElementById('levelDisplay').textContent='Level 1'; document.getElementById('overlay').style.display='none'; lastT = 0; resetPlayer(); requestAnimationFrame(loop); }

    function endGame(){ running = false; document.getElementById('overlay').style.display='flex'; const menu = document.getElementById('menu'); menu.querySelector('h1').textContent = 'GAME OVER'; menu.querySelector('p').innerHTML = `Score: <strong>${Math.floor(score)}</strong>`; menu.querySelector('.row').innerHTML = `<button class='btn primary' id='restartBtn'>Play Again</button><button class='btn' id='menuBtn'>Menu</button>`; // save best
      if(Math.floor(score) > best){ best = Math.floor(score); localStorage.setItem('spaceSurvBest', best); document.getElementById('best').textContent = best }
      // hook buttons
      document.getElementById('restartBtn').addEventListener('click', ()=>{ // restore menu
        resetMenu(); startGame(); });
      document.getElementById('menuBtn').addEventListener('click', ()=>{ resetMenu(); }); }

    function resetMenu(){ const menu = document.getElementById('menu'); menu.querySelector('h1').textContent = 'SPACE SURVIVAL'; menu.querySelector('p').textContent = 'Pilot your spaceship — dodge meteors and survive as long as possible.'; menu.querySelector('.row').innerHTML = `<button class='btn primary' id='startBtn'>Press SPACE to Start</button><button class='btn' id='howBtn'>How to Play</button>`; attachMenu(); document.getElementById('overlay').style.display = 'flex'; }

    function attachMenu(){ const sb = document.getElementById('startBtn'); if(sb) sb.addEventListener('click', ()=>startGame()); const hb = document.getElementById('howBtn'); if(hb) hb.addEventListener('click', ()=>{ const menu = document.getElementById('menu'); menu.querySelector('p').textContent = 'Controls: ← / → or A / D. Tap left/right on touch. Survive waves of meteors. Dodge and survive as long as possible.'; menu.querySelector('.row').innerHTML = `<button class='btn' id='backBtn'>Back</button>`; document.getElementById('backBtn').addEventListener('click', ()=>resetMenu()); }); }

    // Pause / reset UI
    document.getElementById('pauseBtn').addEventListener('click', ()=>{ if(!running) return; paused = !paused; document.getElementById('pauseBtn').textContent = paused? 'Resume':'Pause'; if(!paused) { lastT=0; requestAnimationFrame(loop); } });
    document.getElementById('resetBtn').addEventListener('click', ()=>{ running=false; paused=false; meteors=[]; parts=[]; resetMenu(); });

    // simple game over wrapper to allow explosion sound later
    function endGameWrapper(){ endGame(); }

    // start/restart logic on Space
    window.addEventListener('keydown', e=>{ if(e.code==='Space'){ if(!running) startGame(); else if(!running && !document.getElementById('overlay').style.display) startGame(); } });

    // quick start attach
    attachMenu();

    // initial resize + starfield
    resize();
    // when user resizes, ensure things adapt
    window.addEventListener('orientationchange', ()=>{ resize(); });
  </script>
</body>
</html>
